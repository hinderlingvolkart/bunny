/**
 * @url       https://bunnyjs.com
 * @package   BunnyJS
 * @component BunnyURL
 * @author    Mev-Rael (mevrael@gmail.com)
 */
var BunnyURL = {

    /**
     * Get the value of a URI query HTTP GET param (?param=val) from current URL or string
     * If param has [] in name, returns Array
     * If param not set returns undefined
     * If param exists but has no value returns empty string ''
     *
     * @param  {String}                  get_param  The field to get the value of
     * @param  {String?}                 url        The URL to get the value from, default current URL
     * @return {String|Array|undefined}             The GET param value or undefined
     */
    getParam: function getParam(get_param) {
        var url = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window.location.href;

        var params = this.getParams(url);
        if (params === undefined) {
            return undefined;
        }
        return params[get_param];
    },


    /**
     * Get URL query string (after ?) or false if there are no query string
     * @param {String?} url
     * @returns {String|undefined}
     */
    getQueryString: function getQueryString() {
        var url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.href;

        var pos = url.indexOf('?');
        var hashPos = url.indexOf('#');
        if (hashPos > -1) {
            return pos > -1 ? decodeURI(url.slice(pos + 1, hashPos)) : undefined;
        }
        return pos > -1 ? decodeURI(url.slice(pos + 1)) : undefined;
    },
    getHash: function getHash() {
        var url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.href;

        var pos = url.indexOf('#');
        return pos > -1 ? decodeURI(url.slice(pos + 1)) : undefined;
    },
    getURLWithoutQueryString: function getURLWithoutQueryString() {
        var url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.href;

        var pos = url.indexOf('?');
        return pos > -1 ? decodeURI(url.slice(0, pos)) : url;
    },


    /**
     * Get URL params as object (name => value) or undefined if there are no query string
     * @param {String?} url
     * @returns {Object|undefined}
     */
    getParams: function getParams() {
        var url = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.href;

        var query = this.getQueryString(url);
        if (query === undefined) {
            return undefined;
        }
        var params = {};
        var hashes = query.split('&');
        for (var i = 0; i < hashes.length; i++) {
            var hash = hashes[i].split('=');
            if (hash[0].indexOf('[]') !== -1) {
                // is array
                if (params[hash[0]] === undefined) {
                    params[hash[0]] = [];
                }
                params[hash[0]].push(hash[1]);
            } else {
                params[hash[0]] = hash[1];
            }
        }
        return params;
    },


    /**
     * Check if GET param is in URL even if it has no value
     *
     * @param {String} param
     * @param {String?} url
     * @returns {Boolean}
     */
    hasParam: function hasParam(param) {
        var url = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window.location.href;

        return this.getParam(param, url) !== undefined;
    },
    setParam: function setParam(param, value) {
        var url = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : window.location.href;

        var params = this.getParams(url);
        if (params === undefined) {
            params = {};
        }
        params[param] = value;
        return this.replaceParams(params, url);
    },
    generateQueryString: function generateQueryString(params) {
        var i = 0;
        var queryStr = '';
        for (var k in params) {
            queryStr += i === 0 ? '?' : '&';
            queryStr += k + '=' + params[k];
            i++;
        }
        return queryStr;
    },
    replaceParams: function replaceParams(params) {
        var url = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window.location.href;

        var newUrl = this.getURLWithoutQueryString(url) + this.generateQueryString(params);
        var hash = this.getHash(url);
        if (hash !== undefined) {
            newUrl += '#' + hash;
        }
        return newUrl;
    },
    setParams: function setParams(params) {
        var url = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window.location.href;

        var urlParams = this.getParams(url);
        for (var k in params) {
            urlParams[k] = params[k];
        }
        return this.replaceParams(urlParams, url);
    },
    removeParam: function removeParam(param) {
        var url = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window.location.href;

        var params = this.getParams(url);
        if (params[param] !== undefined) {
            delete params[param];
        }
        return this.replaceParams(params, url);
    }
};

