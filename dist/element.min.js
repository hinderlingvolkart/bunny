var BunnyElement = {
  getCurrentDocumentPosition: function getCurrentDocumentPosition() {
    var top = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;

    //return Math.abs(document.body.getBoundingClientRect().y);
    return top ? window.scrollY : window.scrollY + window.innerHeight;
  },
  getPosition: function getPosition(el) {
    var top = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

    var curTop = 0;
    var originalEl = el;
    if (el.offsetParent) {
      do {
        curTop += el.offsetTop;
      } while (el = el.offsetParent);
    }
    if (!top) {
      curTop += originalEl.offsetHeight;
    }
    return curTop;
  },
  isInViewport: function isInViewport(el) {
    var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var top = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

    var docPos = this.getCurrentDocumentPosition(top);
    var elPos = this.getPosition(el, top);
    return elPos + offset <= docPos;
  },
  scrollToIfNeeded: function scrollToIfNeeded(target) {
    var viewportOffset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var viewportTop = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    var duration = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 500;
    var scrollOffset = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;

    if (!this.isInViewport(target, viewportOffset, viewportTop)) {
      this.scrollTo(target, duration, scrollOffset);
    }
  },


  /**
   * Smooth scrolling to DOM element or to relative window position
   * If target is string it should be CSS selector
   * If target is object it should be DOM element
   * If target is number - it is used to relatively scroll X pixels form current position
   *
   * Based on https://www.sitepoint.com/smooth-scrolling-vanilla-javascript/
   *
   * @param {HTMLElement, string, number} target
   * @param {Number|function} duration
   * @param {Number} offset
   * @param {HTMLElement} rootElement
   */
  scrollTo: function scrollTo(target) {
    var duration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;
    var offset = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var rootElement = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : window;

    return new Promise(function (onAnimationEnd) {

      var element = void 0;
      if (typeof target === 'string') {
        element = document.querySelector(target);
      } else if ((typeof target === 'undefined' ? 'undefined' : babelHelpers.typeof(target)) === 'object') {
        element = target;
      } else {
        // number
        element = null;
      }

      if (element !== null && element.offsetParent === null) {
        // element is not visible, scroll to top of parent element
        element = element.parentNode;
      }

      var start = rootElement === window ? window.pageYOffset : rootElement.scrollTop;
      var distance = 0;
      if (element !== null) {
        distance = element.getBoundingClientRect().top;
      } else {
        // number
        distance = target;
      }

      distance = distance + offset;

      if (typeof duration === 'function') {
        duration = duration(distance);
      }

      var timeStart = 0;
      var timeElapsed = 0;

      requestAnimationFrame(function (time) {
        timeStart = time;
        loop(time);
      });

      function setScrollYPosition(el, y) {
        if (el === window) {
          window.scrollTo(0, y);
        } else {
          el.scrollTop = y;
        }
      }

      function loop(time) {
        timeElapsed = time - timeStart;
        setScrollYPosition(rootElement, easeInOutQuad(timeElapsed, start, distance, duration));
        if (timeElapsed < duration) {
          requestAnimationFrame(loop);
        } else {
          end();
        }
      }

      function end() {
        setScrollYPosition(rootElement, start + distance);
        onAnimationEnd();
      }

      // Robert Penner's easeInOutQuad - http://robertpenner.com/easing/
      function easeInOutQuad(t, b, c, d) {
        t /= d / 2;
        if (t < 1) return c / 2 * t * t + b;
        t--;
        return -c / 2 * (t * (t - 2) - 1) + b;
      }
    });
  },
  hide: function hide(element) {
    return new Promise(function (resolve) {
      element.style.opacity = 0;
      element.style.overflow = 'hidden';
      var steps = 40;
      var step_delay_ms = 10;
      var height = element.offsetHeight;
      var height_per_step = Math.round(height / steps);
      element._originalHeight = height;

      var _loop = function _loop(k) {
        if (k === steps) {
          setTimeout(function () {
            element.style.display = 'none';
            element.style.height = '0px';
            resolve();
          }, step_delay_ms * k);
        } else {
          setTimeout(function () {
            element.style.height = height_per_step * (steps - k) + 'px';
          }, step_delay_ms * k);
        }
      };

      for (var k = 1; k <= steps; k++) {
        _loop(k);
      }
    });
  },
  show: function show(element) {
    if (element._originalHeight === undefined) {
      throw new Error('element._originalHeight is undefined. Save original height when hiding element or use BunnyElement.hide()');
    }
    return new Promise(function (resolve) {
      element.style.display = '';
      var steps = 40;
      var step_delay_ms = 10;
      var height = element._originalHeight;
      var height_per_step = Math.round(height / steps);
      delete element._originalHeight;

      var _loop2 = function _loop2(k) {
        if (k === steps) {
          setTimeout(function () {
            element.style.opacity = 1;
            element.style.height = '';
            element.style.overflow = '';
            resolve();
          }, step_delay_ms * k);
        } else {
          setTimeout(function () {
            element.style.height = height_per_step * k + 'px';
          }, step_delay_ms * k);
        }
      };

      for (var k = 1; k <= steps; k++) {
        _loop2(k);
      }
    });
  },
  remove: function remove(element) {
    element.parentNode.removeChild(element);
  }
};

